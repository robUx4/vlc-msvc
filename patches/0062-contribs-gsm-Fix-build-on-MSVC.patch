From 4ee144c90b50f15cb769c9a0799ff591ad6f041d Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Hugo=20Beauz=C3=A9e-Luyssen?= <hugo@beauzee.fr>
Date: Fri, 6 Feb 2015 18:22:28 +0100
Subject: [PATCH 62/77] contribs: gsm: Fix build on MSVC

---
 contrib/src/gsm/msvc.patch | 10 ++++++++++
 contrib/src/gsm/rules.mak  |  6 ++++++
 2 files changed, 16 insertions(+)
 create mode 100644 contrib/src/gsm/msvc.patch

diff --git a/contrib/src/gsm/msvc.patch b/contrib/src/gsm/msvc.patch
new file mode 100644
index 0000000..e1bb2d1
--- /dev/null
+++ b/contrib/src/gsm/msvc.patch
@@ -0,0 +1,10 @@
+--- /home/vlc/vlc/contrib/windowsphone/gsm/Makefile	2014-12-15 16:54:29.228707100 +0100
++++ gsm/Makefile	2015-01-09 14:00:05.380843300 +0100
+@@ -270,6 +270,7 @@
+ 
+ .c.o:
+ 		$(CC) $(CFLAGS) $?
++		@-cp `$(BASENAME) $(shell echo $@ | sed 's/\.o/\.obj/')` $@ 
+ 		@-mv `$(BASENAME) $@` $@ > /dev/null 2>&1
+ 
+ # Target rules
diff --git a/contrib/src/gsm/rules.mak b/contrib/src/gsm/rules.mak
index 38553d3..5fc7e36 100644
--- a/contrib/src/gsm/rules.mak
+++ b/contrib/src/gsm/rules.mak
@@ -11,6 +11,9 @@ gsm: libgsm_$(GSM_VERSION).tar.gz .sum-gsm
 	$(UNPACK)
 	mv gsm-1.0-* libgsm_$(GSM_VERSION)
 	$(APPLY) $(SRC)/gsm/gsm-cross.patch
+ifdef HAVE_VISUALSTUDIO
+	$(APPLY) $(SRC)/gsm/msvc.patch
+endif
 	sed -e 's/^CFLAGS.*=/CFLAGS+=/' -i.orig libgsm_$(GSM_VERSION)/Makefile
 	$(MOVE)
 
@@ -19,4 +22,7 @@ gsm: libgsm_$(GSM_VERSION).tar.gz .sum-gsm
 	mkdir -p "$(PREFIX)/include/gsm" "$(PREFIX)/lib"
 	cp $</inc/gsm.h "$(PREFIX)/include/gsm/"
 	cp $</lib/libgsm.a "$(PREFIX)/lib/"
+ifdef HAVE_VISUALSTUDIO
+	cp $(PREFIX)/lib/libgsm.a $(PREFIX)/lib/gsm.lib
+endif
 	touch $@
-- 
2.2.0

