From 9475cb8d4c303d8b436e0860c91b58a85ec0e20b Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Hugo=20Beauz=C3=A9e-Luyssen?= <hugo@beauzee.fr>
Date: Wed, 22 Oct 2014 15:16:28 +0200
Subject: [PATCH 29/78] contribs: opus: Force alloca usage when building with
 MSVC

---
 contrib/src/opus/rules.mak | 6 +++++-
 1 file changed, 5 insertions(+), 1 deletion(-)

diff --git a/contrib/src/opus/rules.mak b/contrib/src/opus/rules.mak
index 56f0933..dda0c47 100644
--- a/contrib/src/opus/rules.mak
+++ b/contrib/src/opus/rules.mak
@@ -24,7 +24,11 @@ ifndef HAVE_FPU
 OPUS_CONF += --enable-fixed-point
 endif
 
+ifdef HAVE_VISUALSTUDIO
+OPUS_CFLAGS=-DUSE_ALLOCA
+endif
+
 .opus: opus
-	cd $< && $(HOSTVARS) ./configure $(HOSTCONF) $(OPUS_CONF)
+	cd $< && $(HOSTVARS) ./configure $(HOSTCONF) $(OPUS_CONF) CFLAGS="$(OPUS_CFLAGS)"
 	cd $< && $(MAKE) install
 	touch $@
-- 
2.2.0

