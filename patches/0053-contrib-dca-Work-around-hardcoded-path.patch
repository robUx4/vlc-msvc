From 75b1209fd8f3034c49f0696be20ad60af32b3814 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Hugo=20Beauz=C3=A9e-Luyssen?= <hugo@beauzee.fr>
Date: Thu, 8 Jan 2015 17:31:32 +0100
Subject: [PATCH 53/99] contrib: dca: Work around hardcoded path

---
 contrib/src/dca/msvc.patch | 10 ++++++++++
 contrib/src/dca/rules.mak  |  4 ++++
 2 files changed, 14 insertions(+)
 create mode 100644 contrib/src/dca/msvc.patch

diff --git a/contrib/src/dca/msvc.patch b/contrib/src/dca/msvc.patch
new file mode 100644
index 0000000..203972b
--- /dev/null
+++ b/contrib/src/dca/msvc.patch
@@ -0,0 +1,10 @@
+--- libdca/libdca/Makefile.am.orig	2015-01-08 16:49:51.219945400 +0100
++++ libdca/libdca/Makefile.am	2015-01-08 16:50:13.927927800 +0100
+@@ -14,7 +14,6 @@
+ EXTRA_DIST = configure.incl
+ 
+ install-exec-hook:
+-	ln -sf "$(libdir)/libdca.a" "$(DESTDIR)$(libdir)/libdts.a"
+ 
+ uninstall-hook:
+ 	unlink "$(DESTDIR)$(libdir)/libdts.a"
diff --git a/contrib/src/dca/rules.mak b/contrib/src/dca/rules.mak
index 5a5a8a6..f7d3024 100644
--- a/contrib/src/dca/rules.mak
+++ b/contrib/src/dca/rules.mak
@@ -20,10 +20,14 @@ $(TARBALLS)/libdca-$(DCA_VERSION).tar.bz2:
 libdca: libdca-$(DCA_VERSION).tar.bz2 .sum-dca
 	$(UNPACK)
 	#$(APPLY) $(SRC)/dca/libdca-llvm-gcc.patch
+ifdef HAVE_VISUALSTUDIO
+	$(APPLY) $(SRC)/dca/msvc.patch
+endif
 	$(UPDATE_AUTOCONFIG) && cd $(UNPACK_DIR) && mv config.guess config.sub autotools
 	$(MOVE)
 
 .dca: libdca
+	$(RECONF)
 	cd $< && $(HOSTVARS) CFLAGS="$(CFLAGS) -std=gnu89" ./configure $(HOSTCONF)
 	cd $< && $(MAKE) -C include install
 	cd $< && $(MAKE) -C libdca install
-- 
1.9.5.msysgit.1

