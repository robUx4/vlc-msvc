From e86639910ab5a36172bcee5d45ccb418613179c1 Mon Sep 17 00:00:00 2001
From: Steve Lhomme <windowsrt-build@videolan.org>
Date: Tue, 9 Jun 2015 13:51:43 +0200
Subject: [PATCH 128/128] openjpeg: use the correct download URL and check for
 restrict keyword

---
 contrib/src/openjpeg/restrict.patch | 50 +++++++++++++++++++++++++++++++++++++
 contrib/src/openjpeg/rules.mak      |  3 ++-
 2 files changed, 52 insertions(+), 1 deletion(-)
 create mode 100644 contrib/src/openjpeg/restrict.patch

diff --git a/contrib/src/openjpeg/restrict.patch b/contrib/src/openjpeg/restrict.patch
new file mode 100644
index 0000000..1e80c6a
--- /dev/null
+++ b/contrib/src/openjpeg/restrict.patch
@@ -0,0 +1,50 @@
+diff --git a/configure.ac b/configure.ac
+index 71098e5..8843546 100644
+--- a/configure.ac
++++ b/configure.ac
+@@ -486,6 +486,8 @@ else
+    OPJ_COMPILER_FLAG([-O3])
+ fi
+ 
++AC_C_RESTRICT
++
+ 
+ ### Checks for linker characteristics
+ 
+diff --git a/libopenjpeg/dwt.c b/libopenjpeg/dwt.c
+index 0fbfc20..26ee0f4 100644
+--- a/libopenjpeg/dwt.c
++++ b/libopenjpeg/dwt.c
+@@ -35,6 +35,7 @@
+ #include <xmmintrin.h>
+ #endif
+ 
++#include "opj_config.h"
+ #include "opj_includes.h"
+ 
+ /** @defgroup DWT DWT - Implementation of a discrete wavelet transform */
+diff --git a/libopenjpeg/mct.c b/libopenjpeg/mct.c
+index 870993b..66c91d8 100644
+--- a/libopenjpeg/mct.c
++++ b/libopenjpeg/mct.c
+@@ -33,6 +33,7 @@
+ #include <xmmintrin.h>
+ #endif
+ 
++#include "opj_config.h"
+ #include "opj_includes.h"
+ 
+ /* <summary> */
+diff --git a/libopenjpeg/t1.c b/libopenjpeg/t1.c
+index ed9cdc3..78f6940 100644
+--- a/libopenjpeg/t1.c
++++ b/libopenjpeg/t1.c
+@@ -30,6 +30,7 @@
+  * POSSIBILITY OF SUCH DAMAGE.
+  */
+ 
++#include "opj_config.h"
+ #include "opj_includes.h"
+ #include "t1_luts.h"
+ 
+
diff --git a/contrib/src/openjpeg/rules.mak b/contrib/src/openjpeg/rules.mak
index 4ce06e5..c13e8a7 100644
--- a/contrib/src/openjpeg/rules.mak
+++ b/contrib/src/openjpeg/rules.mak
@@ -1,7 +1,7 @@
 # jpeg
 
 OPENJPEG_VERSION := 1.5.0
-OPENJPEG_URL := http://openjpeg.googlecode.com/files/openjpeg-$(OPENJPEG_VERSION).tar.gz
+OPENJPEG_URL := http://sourceforge.net/projects/openjpeg.mirror/files/$(OPENJPEG_VERSION)/openjpeg-$(OPENJPEG_VERSION).tar.gz/download
 
 $(TARBALLS)/openjpeg-$(OPENJPEG_VERSION).tar.gz:
 	$(call download,$(OPENJPEG_URL))
@@ -15,6 +15,7 @@ ifdef HAVE_VISUALSTUDIO
 	$(APPLY) $(SRC)/openjpeg/msvc.patch
 endif
 	$(APPLY) $(SRC)/openjpeg/freebsd.patch
+	$(APPLY) $(SRC)/openjpeg/restrict.patch
 	$(UPDATE_AUTOCONFIG)
 	$(MOVE)
 
-- 
1.9.5.msysgit.1

