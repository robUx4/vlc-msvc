From 15487f97fd2b8df37efc89a26bf54042bd753d0b Mon Sep 17 00:00:00 2001
From: Steve Lhomme <robux4@gmail.com>
Date: Thu, 25 Jun 2015 16:10:16 +0200
Subject: [PATCH 96/99] libebml: do not build the debug class for the App Store

---
 contrib/src/ebml/msvc.patch | 17 +++++++++++++++++
 contrib/src/ebml/rules.mak  |  3 +++
 2 files changed, 20 insertions(+)
 create mode 100644 contrib/src/ebml/msvc.patch

diff --git a/contrib/src/ebml/msvc.patch b/contrib/src/ebml/msvc.patch
new file mode 100644
index 0000000..0b89462
--- /dev/null
+++ b/contrib/src/ebml/msvc.patch
@@ -0,0 +1,17 @@
+--- libebml/ebml/EbmlConfig.h.old       2015-06-15 08:54:23.813878400 +0200
++++ libebml/ebml/EbmlConfig.h   2015-06-15 08:51:13.878014700 +0200
+@@ -100,6 +100,13 @@
+ #define LIBEBML_DEBUG
+ #endif
+
++#ifdef _MSC_VER
++#include <winapifamily.h>
++# if !WINAPI_FAMILY_PARTITION(WINAPI_PARTITION_DESKTOP)
++#  undef LIBEBML_DEBUG
++# endif
++#endif
++
+ // For compilers that don't define __TIMESTAMP__ (e.g. gcc 2.95, gcc 3.2)
+ #ifndef __TIMESTAMP__
+ #define __TIMESTAMP__ __DATE__ " " __TIME__
+
diff --git a/contrib/src/ebml/rules.mak b/contrib/src/ebml/rules.mak
index 0154809..2110742 100644
--- a/contrib/src/ebml/rules.mak
+++ b/contrib/src/ebml/rules.mak
@@ -11,6 +11,9 @@ $(TARBALLS)/libebml-$(EBML_VERSION).tar.bz2:
 
 libebml: libebml-$(EBML_VERSION).tar.bz2 .sum-ebml
 	$(UNPACK)
+ifdef HAVE_VISUALSTUDIO
+	$(APPLY) $(SRC)/ebml/msvc.patch
+endif
 	$(MOVE)
 
 # libebml requires exceptions
-- 
1.9.5.msysgit.1

