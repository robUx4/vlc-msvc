From 8e33b2535497df047ca7596603c8b7e99fc7d02e Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Hugo=20Beauz=C3=A9e-Luyssen?= <hugo@beauzee.fr>
Date: Thu, 20 Nov 2014 16:19:30 +0100
Subject: [PATCH 48/75] contribs: ffmpeg: Enable native msvc build & tweak
 config for windows phone

---
 contrib/src/ffmpeg/rules.mak | 12 ++++++++++++
 1 file changed, 12 insertions(+)

diff --git a/contrib/src/ffmpeg/rules.mak b/contrib/src/ffmpeg/rules.mak
index f201b7d..bbf59eb 100644
--- a/contrib/src/ffmpeg/rules.mak
+++ b/contrib/src/ffmpeg/rules.mak
@@ -12,6 +12,10 @@ HASH=HEAD
 FFMPEG_SNAPURL := http://git.libav.org/?p=libav.git;a=snapshot;h=$(HASH);sf=tgz
 endif
 
+ifdef HAVE_VISUALSTUDIO
+CC:=cl
+endif
+
 FFMPEGCONF = \
 	--cc="$(CC)" \
 	--pkg-config="$(PKG_CONFIG)" \
@@ -137,8 +141,16 @@ FFMPEGCONF += --enable-w32threads --enable-dxva2 \
 ifdef HAVE_WIN64
 FFMPEGCONF += --cpu=athlon64 --arch=x86_64
 else # !WIN64
+ifdef HAVE_WINPHONE
+FFMPEGCONF += --arch=arm --cpu=armv7-a --target-os=win32 --extra-cflags='-DWINAPI_FAMILY=WINAPI_FAMILY_APP -MD -D__ARM_PCS_VFP -D_WIN32_WINNT=0x602' --disable-dxva2 --as=armasm
+else
 FFMPEGCONF+= --cpu=i686 --arch=x86
 endif
+endif
+
+ifdef HAVE_VISUALSTUDIO
+FFMPEGCONF += --toolchain=msvc
+endif
 
 else # !Windows
 FFMPEGCONF += --enable-pthreads
-- 
2.2.0

