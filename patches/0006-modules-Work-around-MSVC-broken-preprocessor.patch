From 7fc074a5f18cc0f91537f9a4d4b0a3abde932329 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Hugo=20Beauz=C3=A9e-Luyssen?= <hugo@beauzee.fr>
Date: Tue, 21 Oct 2014 15:09:04 +0200
Subject: [PATCH 006/128] modules: Work around MSVC broken preprocessor

---
 modules/access/dtv/access.c                  | 10 +++++++---
 modules/demux/mkv/matroska_segment_parse.cpp |  7 +++----
 modules/demux/mp4/mp4.c                      |  9 +++++----
 3 files changed, 15 insertions(+), 11 deletions(-)

diff --git a/modules/access/dtv/access.c b/modules/access/dtv/access.c
index fd868ab..4813756 100644
--- a/modules/access/dtv/access.c
+++ b/modules/access/dtv/access.c
@@ -245,13 +245,17 @@ vlc_module_begin ()
     set_subcategory (SUBCAT_INPUT_ACCESS)
     set_capability ("access", 0)
     set_callbacks (Open, Close)
+
+#ifdef _WIN32
+# define EXTRA_SHORTCUT  ,"dvbt"
+#else
+# define EXTRA_SHORTCUT
+#endif
     add_shortcut ("dtv", "tv", "dvb", /* "radio", "dab",*/
                   "cable", "dvb-c", "cqam", "isdb-c",
                   "satellite", "dvb-s", "dvb-s2", "isdb-s",
                   "terrestrial", "dvb-t", "dvb-t2", "isdb-t", "atsc"
-#ifdef _WIN32
-                  ,"dvbt"
-#endif
+                  EXTRA_SHORTCUT
                  )
 
 #ifdef HAVE_LINUX_DVB
diff --git a/modules/demux/mkv/matroska_segment_parse.cpp b/modules/demux/mkv/matroska_segment_parse.cpp
index 185fecc6..b40bd8a 100644
--- a/modules/demux/mkv/matroska_segment_parse.cpp
+++ b/modules/demux/mkv/matroska_segment_parse.cpp
@@ -994,13 +994,12 @@ void matroska_segment_c::ParseChapterAtom( int i_level, KaxChapterAtom *ca, chap
         else if( MKV_IS_ID( l, KaxChapterSegmentEditionUID ) )
         {
             chapters.p_segment_edition_uid = new KaxChapterSegmentEditionUID( *static_cast<KaxChapterSegmentEditionUID*>(l) );
-            msg_Dbg( &sys.demuxer, "|   |   |   |   + ChapterSegmentEditionUID= %u",
 #if LIBMATROSKA_VERSION < 0x010300
-                     *(uint32*)chapters.p_segment_edition_uid->GetBuffer()
+            uint32 uuid = *(uint32*)chapters.p_segment_edition_uid->GetBuffer();
 #else
-                     *(uint32*)chapters.p_segment_edition_uid
+            uint32 uuid = *(uint32*)chapters.p_segment_edition_uid;
 #endif
-                   );
+            msg_Dbg( &sys.demuxer, "|   |   |   |   + ChapterSegmentEditionUID= %u", uuid );
         }
         else if( MKV_IS_ID( l, KaxChapterTimeStart ) )
         {
diff --git a/modules/demux/mp4/mp4.c b/modules/demux/mp4/mp4.c
index cd046d0..69f7855 100644
--- a/modules/demux/mp4/mp4.c
+++ b/modules/demux/mp4/mp4.c
@@ -630,14 +630,15 @@ static int Open( vlc_object_t * p_this )
             case MAJOR_3gp5:
             case MAJOR_3gp6:
             case MAJOR_3gp7:
-                msg_Dbg( p_demux, "3GPP Media file Release: %c",
+            {
 #ifdef WORDS_BIGENDIAN
-                        BOXDATA(p_ftyp)->i_major_brand
+                uint32_t mb = BOXDATA(p_ftyp)->i_major_brand;
 #else
-                        BOXDATA(p_ftyp)->i_major_brand >> 24
+                uint32_t mb = BOXDATA(p_ftyp)->i_major_brand >> 24;
 #endif
-                        );
+                msg_Dbg( p_demux, "3GPP Media file Release: %c", mb);
                 break;
+            }
             case MAJOR_qt__:
                 msg_Dbg( p_demux, "Apple QuickTime file" );
                 break;
-- 
1.9.5.msysgit.1

