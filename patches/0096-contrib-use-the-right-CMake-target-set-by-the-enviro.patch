From 1121607385a0f3ebc55450655f6ceb417cc67b79 Mon Sep 17 00:00:00 2001
From: Steve Lhomme <robux4@gmail.com>
Date: Thu, 25 Jun 2015 14:35:10 +0200
Subject: [PATCH 96/96] contrib: use the right CMake target set by the
 environment

---
 contrib/src/mpcdec/rules.mak |  6 +++---
 contrib/src/taglib/rules.mak | 10 +++-------
 2 files changed, 6 insertions(+), 10 deletions(-)

diff --git a/contrib/src/mpcdec/rules.mak b/contrib/src/mpcdec/rules.mak
index 2f645ce..3275698 100644
--- a/contrib/src/mpcdec/rules.mak
+++ b/contrib/src/mpcdec/rules.mak
@@ -44,9 +44,9 @@ endif
 
 .mpcdec: musepack toolchain.cmake
 ifdef HAVE_VISUALSTUDIO	
-	cd $< && $(HOSTVARS_PIC) $(CMAKE) -DSHARED=OFF -G "Visual Studio 12 2013 ARM" .
-	cd $< && msbuild.exe -p:Configuration=Release -p:Platform=ARM INSTALL.vcxproj
-	cd $< && cp libmpcdec/Release/mpcdec_static.lib "$(PREFIX)/lib/mpcdec.lib"
+	cd $< && $(HOSTVARS_PIC) $(CMAKE) -DSHARED=OFF $(CMAKE_TARGET)
+	cd $< && msbuild.exe -p:Configuration=$(VLC_CONFIGURATION) INSTALL.vcxproj
+	cd $< && cp libmpcdec/$(VLC_CONFIGURATION)/mpcdec_static.lib "$(PREFIX)/lib/mpcdec.lib"
 	cd $< && cp "$(PREFIX)/lib/mpcdec.lib" "$(PREFIX)/lib/libmpcdec.a"
 else
 	cd $< && $(HOSTVARS_PIC) $(CMAKE) -DSHARED=OFF .
diff --git a/contrib/src/taglib/rules.mak b/contrib/src/taglib/rules.mak
index b0ab6c5..cdfcfa9 100644
--- a/contrib/src/taglib/rules.mak
+++ b/contrib/src/taglib/rules.mak
@@ -8,10 +8,6 @@ ifeq ($(call need_pkg,"taglib >= 1.9"),)
 PKGS_FOUND += taglib
 endif
 
-ifdef HAVE_VISUALSTUDIO
-BUILD_TARGET=-G "Visual Studio 12 2013 ARM"
-endif
-
 $(TARBALLS)/taglib-$(TAGLIB_VERSION).tar.gz:
 	$(call download,$(TAGLIB_URL))
 
@@ -29,10 +25,10 @@ taglib: taglib-$(TAGLIB_VERSION).tar.gz .sum-taglib
 		-DENABLE_STATIC:BOOL=ON \
 		-DWITH_ASF:BOOL=ON \
 		-DWITH_MP4:BOOL=ON \
-		$(BUILD_TARGET) .
+		$(CMAKE_TARGET) .
 ifdef HAVE_VISUALSTUDIO
-	cd $< && msbuild.exe -p:Configuration=Release -p:Platform=ARM INSTALL.vcxproj
-	cd $< && cp taglib/Release/tag.lib "$(PREFIX)/lib/libtag.a"
+	cd $< && msbuild.exe -p:Configuration=$(VLC_CONFIGURATION) INSTALL.vcxproj
+	cd $< && cp taglib/$(VLC_CONFIGURATION)/tag.lib "$(PREFIX)/lib/libtag.a"
 else
 	cd $< && $(MAKE) install
 endif
-- 
2.4.2

