From c85e10c0cbfcc34125bd870d9492553de950974b Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Hugo=20Beauz=C3=A9e-Luyssen?= <hugo@beauzee.fr>
Date: Fri, 9 Jan 2015 14:06:35 +0100
Subject: [PATCH 69/74] contribs: gsm: work around broken build system

---
 contrib/src/gsm/msvc.patch | 10 ++++++++++
 contrib/src/gsm/rules.mak  |  3 +++
 2 files changed, 13 insertions(+)
 create mode 100644 contrib/src/gsm/msvc.patch

diff --git a/contrib/src/gsm/msvc.patch b/contrib/src/gsm/msvc.patch
new file mode 100644
index 0000000..e1bb2d1
--- /dev/null
+++ b/contrib/src/gsm/msvc.patch
@@ -0,0 +1,10 @@
+--- /home/vlc/vlc/contrib/windowsphone/gsm/Makefile	2014-12-15 16:54:29.228707100 +0100
++++ gsm/Makefile	2015-01-09 14:00:05.380843300 +0100
+@@ -270,6 +270,7 @@
+ 
+ .c.o:
+ 		$(CC) $(CFLAGS) $?
++		@-cp `$(BASENAME) $(shell echo $@ | sed 's/\.o/\.obj/')` $@ 
+ 		@-mv `$(BASENAME) $@` $@ > /dev/null 2>&1
+ 
+ # Target rules
diff --git a/contrib/src/gsm/rules.mak b/contrib/src/gsm/rules.mak
index 38553d3..faeedf7 100644
--- a/contrib/src/gsm/rules.mak
+++ b/contrib/src/gsm/rules.mak
@@ -11,6 +11,9 @@ gsm: libgsm_$(GSM_VERSION).tar.gz .sum-gsm
 	$(UNPACK)
 	mv gsm-1.0-* libgsm_$(GSM_VERSION)
 	$(APPLY) $(SRC)/gsm/gsm-cross.patch
+ifdef HAVE_VISUALSTUDIO
+	$(APPLY) $(SRC)/gsm/msvc.patch
+endif
 	sed -e 's/^CFLAGS.*=/CFLAGS+=/' -i.orig libgsm_$(GSM_VERSION)/Makefile
 	$(MOVE)
 
-- 
2.2.0

